# lucene底层学习（一）
实现搜索引擎的功能并不难，通过文档很快便能实现自己的全文搜索，但要深入的使用搜索引擎，就必须要去了解lucene的底层知识以及它是怎么具体实现索引的创建和搜索的。这样在之后应用Solr和ES等工具时，也能根据情况优化我们的索引系统。

另外由于我们的小组作业是将Nutch和Lucene相结合，后面也会有笔记介绍，这样就能实现一个超级简单的类似百度的搜索引擎啦

## 全文检索的原理
在分析lucene的源码之前，有必要理解全文搜索的原理，然后再去研究lucene是怎么实践全文检索的。在我们一般的阅读理解中，都是文档到字符串的映射，比如一篇文章包含了多少个单词。而在搜索中是恰好相反的，要根据字符串创建对文档的映射，如搜索一个单词，将所有包含该单词的文档显示出来。这就是**反向索引**和下面这张图一样。
（图片来自：[https://blog.csdn.net/forfuture1978/article/details/83516408](https://blog.csdn.net/forfuture1978/article/details/83516408)）
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191127125208571.png)
***
所以搜索引擎要做的事情大体上来说有两个，一个是创建索引，一个是对索引进行搜索。

### 创建索引
创建索引的步骤一般来说如下：
* 从数据源传入源文档
* 将源文档进行分词
* 对一些无意义词进行删除
* 将划分后的词传给索引组件
*  索引组件将词进行字典设置，排序，合并，生成倒排表

经过这一系列的处理，最后得到的倒排表类似如下：
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191127131016604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODQzNjM5,size_16,color_FFFFFF,t_70)

在最后一步即生成了倒排表表，一个词指向包含这个词的文档个数，在搜索的时候，根据查询的词来找到文档即可。后面我也会着重分析lucene在创建索引上的工作。

上述步骤即是一般的创建索引的流程，值得注意的一点是，就我使用经验来说，在分词这一块，lucene和Solr对中文的分词是支持的不太好的。如果想对中文文档实现索引的构建，需要借助中文分词器如IKanalyser等工具来进行配置。

## 对索引进行搜索
看似只要将用户的查询语句进行分词，再遍历倒排表找出对应文档返回就好了。其实并不是这样，真实情况往往要复杂的多。

### 对查询语句进行词法，语法分析
在各种搜索引擎中，都会对查询语句进行语法的处理。比如我们搜索 互联网 -百度.即在搜索互联网关键字的结果中剔除掉含有”百度“关键词的文档。这是在搜索的过程中要做的一件事情。
### 查询结果排序
而在得到了相关文档集之后，如何对这些文档集进行排序展示也是必须要考虑得到的一个问题。在通常的全文搜索中，一般是每篇文档中包含的主题词不同，即该文档中词权重不一样。如果一个词对某一篇文章的影响很大，而搜索的词也有这个词，即优先展示此篇文章。所以在对索引进行搜索的时候，也要考虑倒如何对搜索结果进行排序。

## Lucene对全文检索原理的实践
上面介绍了全文搜索的基本原理后，后面的学习过程中即根据lucene的源码来分析它是怎么完成这样的全文搜索的。其简单的结构图是下面这样：可以看出，基本也是两个模块。文件的反向索引和对索引的搜索。但在每个模块里，lucene都有其复杂的处理过程。后面会选择重要的模块进行简单的分析。然后根据lucene实现一个搜索服务。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20191127134506842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODQzNjM5,size_16,color_FFFFFF,t_70)



